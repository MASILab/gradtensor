compute_approx_corr_dwi('/home/local/VANDERBILT/kanakap/gradtensor_data/fieldmaps/3tb_future_fieldmap/OUTPUTS_zero_grad/L.nii.gz','/nfs/masi/kanakap/projects/LR/aggregate_study/OUTPUT_masivar_SNR30_d32_1_corr/uncorrected_Nest_sig.nii','/home/local/VANDERBILT/kanakap/MASIVAR_LR_input1/sub-cIIs00_ses-s1Bx1_acq-b1000n32r25x25x25peAPP_run-112_dwi.bval','/home/local/VANDERBILT/kanakap/MASIVAR_LR_input1/sub-cIIs00_ses-s1Bx1_acq-b1000n32r25x25x25peAPP_run-112_dwi.bvec','/home/local/VANDERBILT/kanakap/MASIVAR_LR_input1/mask.nii','approx_Ncorrected','/nfs/masi/kanakap/projects/LR/aggregate_study/OUTPUT_masivar_SNR30_d32_1_corr')

compute_approx_corr_dwi('/home/local/VANDERBILT/kanakap/gradtensor_data/fieldmaps/3tb_future_fieldmap/OUTPUTS/L.nii.gz','/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs001/ses-s1Bx2/prequal_dwi_cat/sub-cIVs001_ses-s1Bx2_acq-b1000b2000n96r21x21x22_run-1_dwi.nii','/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs001/ses-s1Bx2/prequal_dwi_cat/sub-cIVs001_ses-s1Bx2_acq-b1000b2000n96r21x21x22peAPP_run-1_dwi.bval','/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs001/ses-s1Bx2/prequal_dwi_cat/sub-cIVs001_ses-s1Bx2_acq-b1000b2000n96r21x21x22peAPP_run-1_dwi.bvec','','approx_Ncorrected','/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs001/ses-s1Bx2/prequal_dwi_cat')

compute_approx_corr_dwi('/home/local/VANDERBILT/kanakap/L.nii.gz','/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs096/ses-s1Bx1/prequal_dwi_cat/sub-cIVs096_ses-s1Bx1_acq-b1000b2000n96r21x21x22peAPP_run-1_dwi.nii','/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs096/ses-s1Bx1/prequal_dwi_cat/sub-cIVs096_ses-s1Bx1_acq-b1000b2000n96r21x21x22peAPP_run-1_dwi.bval','/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs096/ses-s1Bx1/prequal_dwi_cat/sub-cIVs096_ses-s1Bx1_acq-b1000b2000n96r21x21x22peAPP_run-1_dwi.bvec','','approx_Lcorrected','/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs096/ses-s1Bx1/prequal_dwi_cat')

dti_voxel_fit_sig('/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs096/ses-s1Bx1/prequal_dwi_cat/approx_Lcorrected_sig.nii','/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs001/ses-s1Bx2/prequal_dwi_cat/sub-cIVs001_ses-s1Bx2_acq-b1000b2000n96r21x21x22peAPP_run-1_dwi.bvec','/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs001/ses-s1Bx2/prequal_dwi_cat/sub-cIVs001_ses-s1Bx2_acq-b1000b2000n96r21x21x22peAPP_run-1_dwi.bval','','/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs096/ses-s1Bx1/prequal_dwi_cat','approx_corr')



apply_gradtensor_to_b('Limg_file','/home/local/VANDERBILT/kanakap/gradtensor_data/fieldmaps/3tb_future_fieldmap/OUTPUTS_zero_grad/L.nii.gz','refimg_file','/nfs/masi/kanakap/projects/LR/aggregate_study/OUTPUT_masivar_SNR30_d32_1_corr/uncorrected_Nest_sig.nii','bval_file','/home/local/VANDERBILT/kanakap/MASIVAR_LR_input1/sub-cIIs00_ses-s1Bx1_acq-b1000n32r25x25x25peAPP_run-112_dwi.bval','bvec_file','/home/local/VANDERBILT/kanakap/MASIVAR_LR_input1/sub-cIIs00_ses-s1Bx1_acq-b1000n32r25x25x25peAPP_run-112_dwi.bvec','out_dir','/nfs/masi/kanakap/projects/LR/aggregate_study/OUTPUT_masivar_SNR30_d32_1_corr/Nemp')

compute_noise_corrput_signal_v1('/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs001/ses-s1Bx2/sub-cIVs001_ses-s1Bx2_acq-b1000b2000n96r21x21x22peAPP_run-1_dwi.nii.gz','','/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs001/ses-s1Bx2/tracto_ip_2','test','/home/local/VANDERBILT/kanakap/gradtensor_data/fieldmaps/3tb_future_fieldmap/OUTPUTS/L.nii.gz','/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs001/ses-s1Bx2/sub-cIVs001_ses-s1Bx2_acq-b1000b2000n96r21x21x22peAPP_run-1_dwi.bvec','/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs001/ses-s1Bx2/prequal_dwi_cat/sub-cIVs001_ses-s1Bx2_acq-b1000b2000n96r21x21x22peAPP_run-1_dwi.bval','inf');

compute_noise_corrput_signal_v1('/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs075/ses-s1Bx2/prequal_dwi_cat/sub-cIVs075_ses-s1Bx2_acq-b1000b2000n96r21x21x22peAPP_run-2_dwi.nii','','/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs075/ses-s1Bx2/tracto_ip_2','uncorrected','/home/local/VANDERBILT/kanakap/gradtensor_data/fieldmaps/3tb_future_fieldmap/OUTPUTS/L.nii.gz','/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs075/ses-s1Bx2/prequal_dwi_cat/sub-cIVs075_ses-s1Bx2_acq-b1000b2000n96r21x21x22peAPP_run-2_dwi.bvec','/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs075/ses-s1Bx2/prequal_dwi_cat/sub-cIVs075_ses-s1Bx2_acq-b1000b2000n96r21x21x22peAPP_run-2_dwi.bval','inf')

compute_noise_corrput_signal_v1('/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs057/ses-s1Bx2/prequal_dwi_cat/sub-cIVs057_ses-s1Bx2_acq-b1000b2000n96r21x21x22peAPP_run-2_dwi.nii','','/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs057/ses-s1Bx2/tracto_ip_2','uncorrected','/home/local/VANDERBILT/kanakap/gradtensor_data/fieldmaps/3tb_future_fieldmap/OUTPUTS/L.nii.gz','/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs057/ses-s1Bx2/prequal_dwi_cat/sub-cIVs057_ses-s1Bx2_acq-b1000b2000n96r21x21x22peAPP_run-2_dwi.bvec','/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs057/ses-s1Bx2/prequal_dwi_cat/sub-cIVs057_ses-s1Bx2_acq-b1000b2000n96r21x21x22peAPP_run-2_dwi.bval','inf')

compute_noise_corrput_signal

compute_noise_corrput_signal('/home/local/VANDERBILT/kanakap/MASIVAR_LR_input1/sub-cIIs00_ses-s1Bx1_acq-b1000n32r25x25x25peAPP_run-112_dwi.nii','/home/local/VANDERBILT/kanakap/gradtensor_data/10_29_2019_human_repositioned/3tb/posA/OUTPUTS_future_fieldmap/corrected_bvec/','/home/local/VANDERBILT/kanakap/gradtensor_data/10_29_2019_human_repositioned/3tb/posA/OUTPUTS_future_fieldmap/corrected_bval/','/home/local/VANDERBILT/kanakap/MASIVAR_LR_input1/mask.nii','/nfs/masi/kanakap/projects/LR/aggregate_study/OUTPUT_masivar_SNRinf_d32_1','uncorrected','/home/local/VANDERBILT/kanakap/gradtensor_data/fieldmaps/3tb_future_fieldmap/OUTPUTS/L.nii.gz','/home/local/VANDERBILT/kanakap/MASIVAR_LR_input1/sub-cIIs00_ses-s1Bx1_acq-b1000n32r25x25x25peAPP_run-112_dwi.bvec','/home/local/VANDERBILT/kanakap/MASIVAR_LR_input1/sub-cIIs00_ses-s1Bx1_acq-b1000n32r25x25x25peAPP_run-112_dwi.bval',inf)


function dti_voxel_fit_sig(dwi_path,bvec_path,bval_path,mask_path, out_dir, out_name)
dti_voxel_fit_sig('/nfs/masi/kanakap/projects/LR/masivar_input/1/sub-cIIs00_ses-s1Bx1_acq-b1000n32r25x25x25peAPP_run-112_dwi.nii','/nfs/masi/kanakap/projects/LR/masivar_input/1/sub-cIIs00_ses-s1Bx1_acq-b1000n32r25x25x25peAPP_run-112_dwi.bvec','/nfs/masi/kanakap/projects/LR/masivar_input/1/sub-cIIs00_ses-s1Bx1_acq-b1000n32r25x25x25peAPP_run-112_dwi.bval','/nfs/masi/kanakap/projects/LR/masivar_input/1/mask.nii','/nfs/masi/kanakap/projects/LR/masivar_input/1','true')

dti_voxel_fit_sig('/nfs/masi/kanakap/projects/LR/masivar_input/10/sub-cIIIs01_ses-s1Bx1_acq-b1000n40r21x21x22peAPP_run-105_dwi.nii','/nfs/masi/kanakap/projects/LR/masivar_input/10/sub-cIIIs01_ses-s1Bx1_acq-b1000n40r21x21x22peAPP_run-105_dwi.bvec','/nfs/masi/kanakap/projects/LR/masivar_input/10/sub-cIIIs01_ses-s1Bx1_acq-b1000n40r21x21x22peAPP_run-105_dwi.bval','/nfs/masi/kanakap/projects/LR/masivar_input/10/mask.nii','/nfs/masi/kanakap/projects/LR/masivar_input/10/','true')

dti_voxel_fit_sig('/nfs/masi/kanakap/projects/LR/masivar_input/11/sub-cIIs00_ses-s1Bx1_acq-b1000n96r25x25x25peAPP_run-109_dwi.nii','/nfs/masi/kanakap/projects/LR/masivar_input/11/sub-cIIs00_ses-s1Bx1_acq-b1000n96r25x25x25peAPP_run-109_dwi.bvec','/nfs/masi/kanakap/projects/LR/masivar_input/11/sub-cIIs00_ses-s1Bx1_acq-b1000n96r25x25x25peAPP_run-109_dwi.bval','/nfs/masi/kanakap/projects/LR/masivar_input/11/mask.nii','/nfs/masi/kanakap/projects/LR/masivar_input/11/','true')

dti_voxel_fit_sig('/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs001/ses-s1Bx2/tracto_ip_1/uncorrected_Lest_sig.nii','/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs001/ses-s1Bx2/tracto_ip_1/sub-cIVs001_ses-s1Bx2_acq-b1000b2000n96r21x21x22peAPP_run-1_dwi.bvec','/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs001/ses-s1Bx2/tracto_ip_1/sub-cIVs001_ses-s1Bx2_acq-b1000b2000n96r21x21x22peAPP_run-1_dwi.bval','/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs001/ses-s1Bx2/tracto_op_1_Lest/sub-cIVs001_ses-s1Bx2__b0_mask_resampled.nii.gz','/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs001/ses-s1Bx2/tracto_ip_1/','corpt')

dti_voxel_fit_sig('/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs001/ses-s1Bx2/prequal_dwi_cat/sub-cIVs001_ses-s1Bx2_acq-b1000b2000n96r21x21x22peAPP_run-1_dwi.nii','/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs001/ses-s1Bx2/prequal_dwi_cat/sub-cIVs001_ses-s1Bx2_acq-b1000b2000n96r21x21x22peAPP_run-1_dwi.bvec','/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs001/ses-s1Bx2/prequal_dwi_cat/sub-cIVs001_ses-s1Bx2_acq-b1000b2000n96r21x21x22peAPP_run-1_dwi.bval','/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs001/ses-s1Bx2/tracto_op_1_Lest/sub-cIVs001_ses-s1Bx2__b0_mask_resampled.nii.gz','/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs001/ses-s1Bx2/prequal_dwi_cat/','true')


flags = struct( ...
        'mask',true, ...
        'mean',false, ...
        'interp',1, ...
        'which',1, ...
        'wrap',[0 0 0], ...
        'prefix','r' ...
        );
refimg_file='/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs001/ses-s1Bx2/tracto_ip_1/uncorrected_Lest_sig.nii'
Limg_file='/nfs/masi/kanakap/projects/LR_tract/MASiVar_kids/sub-cIVs001/ses-s1Bx2/tracto_op_1_Lest/bundles/sub-cIVs001_ses-s1Bx2__AC_cleaned_tdi_mask.nii.gz'
spm_reslice({refimg_file; Limg_file},flags);
